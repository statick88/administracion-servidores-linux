---
title: "Anexo G: OpenCode - Mini-Curso para Gesti贸n de Servidores"
subtitle: "Flujos de trabajo seguros para diagnosticar, automatizar y documentar cambios"
author: "Diego Saavedra"
date: "2026-02-08"
date-format: medium
version: "1.1.53"
---

# Anexo G: OpenCode - Mini-Curso para Gesti贸n de Servidores

## Introducci贸n

**OpenCode** es un asistente interactivo para tareas de ingenier铆a de software. En gesti贸n de servidores, su valor aparece cuando necesitas:

- diagnosticar incidentes con evidencia (logs, m茅tricas, configuraciones)
- generar procedimientos repetibles (runbooks)
- automatizar tareas con scripts (Bash/PowerShell) y herramientas de provisioning
- reducir errores humanos (checklists, validaciones, comandos con modo seguro)

Ver gu铆a completa de configuraci贸n en: [**SETUP.qmd**](../SETUP.qmd)

**Tiempo estimado:** 45-60 minutos

---

## Objetivos de aprendizaje

Al finalizar este mini-curso podr谩s:

- recolectar evidencia b谩sica del sistema sin interrumpir el servicio
- pedir a OpenCode un plan de diagn贸stico paso a paso (y verificarlo)
- generar comandos seguros (read-only primero, luego cambios)
- documentar y estandarizar una correcci贸n en un runbook
- crear una automatizaci贸n peque帽a (script) para tareas repetidas

---

## Reglas de seguridad (antes de usar AI)

:::{.callout-warning}
## ADVERTENCIA CRITICA

**Nunca pegues secretos en OpenCode.**

**Lo que podr铆a salir mal:**
- Filtras credenciales (tokens, claves privadas, passwords) en historiales, logs o capturas.
- Compartes informacion sensible (IPs publicas, nombres internos, rutas) que se usa para ataques.

**C贸mo prevenirlo:**
1. Redacta secretos antes de pegar texto (reemplaza por `REDACTED`).
2. Comparte solo el m铆nimo necesario (1-2 comandos, 20-50 l铆neas de log, el error completo).
3. Prefiere comandos de lectura primero (`status`, `show`, `--dry-run`).
:::

---

## Flujo recomendado: evidencia -> an谩lisis -> acci贸n

1. **Evidencia:** captura estado del sistema, servicio y logs (sin modificar nada).
2. **An谩lisis con OpenCode:** pega evidencia y pide hip贸tesis + plan de verificaci贸n.
3. **Acci贸n controlada:** ejecuta cambios peque帽os, reversibles y con verificaci贸n.
4. **Documentaci贸n:** convierte lo aprendido en runbook (pasos, comandos, rollback).

---

## Instalaci贸n de OpenCode

OpenCode se puede instalar como binario (script), como paquete Node, o via Homebrew.

::: {.panel-tabset}

### Linux/macOS (script)

```bash
$ curl -fsSL https://opencode.ai/install | bash  # <1>
# <1>
```



1. **curl ... | bash** instala el binario de OpenCode usando el instalador oficial.

### Node.js (npm/pnpm/bun)

```bash
$ npm install -g opencode-ai  # <1>
$ pnpm install -g opencode-ai  # <2>
$ bun install -g opencode-ai  # <3>
# <1>
# <2>
# <3>
```



1. **npm install -g** instala OpenCode globalmente.
2. **pnpm install -g** instala OpenCode globalmente usando pnpm.
3. **bun install -g** instala OpenCode globalmente usando bun.

### macOS/Linux (Homebrew)

```bash
$ brew install anomalyco/tap/opencode  # <1>
# <1>
```



1. **brew install anomalyco/tap/opencode** instala la versi贸n m谩s actual desde el tap oficial.

### Windows

```powershell
PS> choco install opencode  # <1>
PS> scoop install opencode  # <2>
PS> npm install -g opencode-ai  # <3>
# <1>
# <2>
# <3>
```



1. **choco install** instala OpenCode con Chocolatey.
2. **scoop install** instala OpenCode con Scoop.
3. **npm install -g** instala OpenCode via Node.js.

:::

---

## OpenCode Desktop (Beta)

Desde v1.1.0, OpenCode ofrece una aplicaci贸n de escritorio con interfaz gr谩fica.

### Descarga e instalaci贸n

::: {.panel-tabset}

### macOS

```bash
$ brew install --cask opencode  # <1>
# <1>
```

1. **brew install --cask** instala la aplicaci贸n de escritorio de OpenCode.

### Windows

```powershell
PS> winget install Anomaly.OpenCode  # <1>
# <1>
```

1. **winget install** descarga e instala OpenCode Desktop.

### Linux (AppImage)

```bash
$ wget https://opencode.ai/download/linux  # <1>
$ chmod +x opencode-*.AppImage  # <2>
$ ./opencode-*.AppImage  # <3>
# <1>
# <2>
# <3>
```

1. **wget** descarga el AppImage de OpenCode.
2. **chmod +x** hace ejecutable el archivo.
3. **./opencode-*.AppImage** ejecuta la aplicaci贸n.

:::

:::{.callout-tip}
##  RECOMENDACIN

**驴Terminal o Desktop?**

**Usa Terminal (TUI) cuando:**
- Trabajas en servidores remotos v铆a SSH
- Necesitas integraci贸n con scripts
- Prefieres flujos de trabajo keyboard-centric

**Usa Desktop cuando:**
- Necesitas visualizar archivos y 谩rbol de proyecto
- Prefieres interfaz gr谩fica para revisar cambios
- Trabajas en proyectos locales con muchos archivos
:::

---

## Configurar proveedor (LLM)

OpenCode requiere un proveedor/modelo (y sus credenciales) para funcionar.

En la TUI, el camino m谩s simple es:

```text
/connect  # <1>
# <1>
```



1. **/connect** abre el flujo para configurar un proveedor (por ejemplo, OpenCode Zen u otro provider).

---

## Inicializar un proyecto (/init)

Entra a tu repo/proyecto y levanta OpenCode:

```bash
$ cd /path/to/project  # <1>
$ opencode  # <2>
# <1>
# <2>
```



1. **cd** cambia al proyecto que vas a administrar.
2. **opencode** inicia la interfaz TUI.

Luego, inicializa el proyecto:

```text
/init  # <1>
# <1>
```



1. **/init** analiza el proyecto y crea `AGENTS.md` en la raiz.

Recomendaci贸n:

- Commitea `AGENTS.md` en Git. Es parte del "contrato" del proyecto para que OpenCode entienda estructura, convenciones y l铆mites.

---

## Modos de trabajo: Plan vs Build

OpenCode tiene dos modos:

- **Plan mode:** el agente propone un plan sin tocar archivos.
- **Build mode:** el agente ejecuta cambios (edita/crea archivos).

Se alterna con **Tab** (ver谩s el indicador en la esquina inferior derecha).

Uso recomendado para servidores:

1. Plan mode: pedir diagn贸stico, hip贸tesis, comandos read-only, verificaci贸n.
2. Build mode: solo cuando el plan es correcto y el cambio es reversible.

---

## Deshacer y rehacer cambios (/undo, /redo)

Si OpenCode hizo cambios que no quieres:

```text
/undo  # <1>
/redo  # <2>
# <1>
# <2>
```



1. **/undo** revierte los cambios del 煤ltimo pedido.
2. **/redo** reaplica los cambios deshechos.

---

## Compartir sesiones (/share) y pol铆tica de privacidad

Compartir es una acci贸n expl铆cita. Al usar `/share`, OpenCode sincroniza el historial a servidores para generar un link p煤blico.

```text
/share  # <1>
/unshare  # <2>
# <1>
# <2>
```



1. **/share** publica un link de la conversaci贸n.
2. **/unshare** elimina el link y deja la conversacion sin acceso publico.

Para entornos sensibles (empresas / infra / clientes), deshabilita el share por proyecto:

```text
{ "$schema": "https://opncd.ai/config.json", "share": "disabled" }  # <1>
```



1. **share: disabled** desactiva el compartir (recomendado en proyectos con informacion sensible).

---

## Ejemplo 1: Inventario r谩pido del servidor (multi-SO)

::: {.panel-tabset}

### Linux

```bash
$ uname -m  # <1>
x86_64

$ free -h  # <2>
               total        used        free      shared  buff/cache   available
Mem:           15Gi       4.2Gi       8.2Gi       412Mi       3.1Gi        10Gi
Swap:         2.0Gi          0B       2.0Gi

$ df -h /  # <3>
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        80G   22G   55G  29% /
# <1>
# <2>
# <3>
```



1. **uname -m** confirma la arquitectura (煤til para binarios y contenedores)
2. **free -h** muestra uso de RAM en formato legible
3. **df -h /** revisa espacio del filesystem principal

### macOS

```bash
$ system_profiler SPHardwareDataType  # <1>

Hardware Overview:
  Model Name: MacBook Pro
  Model Identifier: MacBookPro18,3
  Processor Name: Apple M3 Pro
  Number of Cores: 12 core CPU
  Memory: 16 GB

$ df -h /  # <2>
Filesystem      Size   Used  Avail Capacity iused      ifree %iused  Mounted on
/dev/disk3s1   460Gi  210Gi  245Gi    47%  1.9M       2.4G    0%    /
# <1>
# <2>
```



1. **system_profiler SPHardwareDataType** entrega un resumen del hardware
2. **df -h /** valida uso de disco (煤til antes de builds, logs o backups)

### Windows

```powershell
PS> systeminfo  # <1>

Computer Name:          USUARIO-PC
Processor(s):           1 Logical Processor
System Type:            x86-64-based PC
Total Physical Memory:  16384 MB

PS> Get-PSDrive -PSProvider FileSystem  # <2>

Name Used (GB) Free (GB) Provider      Root
---- --------- --------- --------      ----
C       55.20     180.10 FileSystem    C:\\
# <1>
# <2>
```



1. **systeminfo** muestra inventario b谩sico (CPU, tipo de sistema, RAM)
2. **Get-PSDrive** revisa espacio disponible por unidad

:::

Como usarlo con OpenCode:

- Pega la salida y pregunta: "Con estos datos, que riesgos ves (disco, RAM, arquitectura) para desplegar X? Dame una checklist de preflight".

---

## Ejemplo 2: Diagn贸stico de un servicio (Nginx) en Linux

```bash
$ systemctl status nginx --no-pager  # <1>
* nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled)
     Active: active (running) since Sun 2026-02-01 09:12:14 UTC; 2h 10min ago

$ journalctl -u nginx --since "30 min ago" --no-pager  # <2>
Feb 01 11:11:03 server nginx[1234]: 2026/02/01 11:11:03 [error] 1234#1234: *918 connect() failed (111: Connection refused) while connecting to upstream

$ nginx -t  # <3>
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
# <1>
# <2>
# <3>
```



1. **systemctl status nginx --no-pager** valida estado del servicio sin paginador
2. **journalctl -u nginx --since** obtiene errores recientes del servicio
3. **nginx -t** valida sintaxis de configuraci贸n antes de recargar

Prompt sugerido para OpenCode (pega 10-30 lineas reales del log):

- "Analiza este error de Nginx y prop贸n 3 hip贸tesis ordenadas por probabilidad. Para cada una, dame un comando de verificaci贸n (solo lectura) y el criterio de confirmaci贸n".

---

## Ejemplo 2.1: Checklist de preflight (antes de tocar producci贸n)

Objetivo: pedir a OpenCode una checklist corta, ejecutable y segura.

Prompt sugerido (Plan mode):

```text
Estoy por desplegar X en este servidor.

Evidencia: (pego outputs de uname/free/df/systemctl/journalctl).

Necesito una checklist de preflight de 10 items max:
- Solo comandos read-only
- Criterio de OK/FAIL por cada comando
- Riesgo si se ignora
# <1>
```



1. **Checklist de preflight** fuerza a que el resultado sea accionable y verificable (no solo consejos).

---

## Ejemplo 3: Convertir un procedimiento en runbook (plantilla)

Usa esta plantilla para estandarizar correcciones y evitar repetici贸n:

1. **Contexto:** que paso, impacto, desde cuando
2. **Evidencia:** comandos ejecutados + salidas relevantes
3. **Causa ra铆z:** qu茅 lo provoc贸 (y c贸mo se confirma)
4. **Fix:** pasos exactos (preferir cambios reversibles)
5. **Verificaci贸n:** c贸mo confirmar que qued贸 bien (m茅tricas, healthchecks)
6. **Rollback:** como volver atras si algo sale mal

---

## Custom commands (para runbooks repetibles)

OpenCode permite comandos custom por proyecto. Esto es 煤til para estandarizar runbooks.

Ejemplo: crear `.opencode/commands/preflight.md`:

```markdown
---
description: Checklist preflight (servidores)
agent: plan
---
Genera una checklist de preflight (max 12 items) para el cambio: $ARGUMENTS.
Reglas:
- solo comandos read-only
- incluye criterio OK/FAIL por item
- incluye rollback / mitigaci贸n r谩pida si detectas riesgo
# <1>
```



1. **.opencode/commands/** permite ejecutar prompts repetibles como comandos en la TUI.

---

## MCP Servers (Model Context Protocol)

Desde v1.1.x, OpenCode soporta MCP servers - herramientas externas que extienden las capacidades del agente.

### 驴Qu茅 son los MCP Servers?

Los MCP (Model Context Protocol) servers permiten a OpenCode:
- Ejecutar comandos en servidores remotos via SSH
- Consultar bases de datos directamente
- Integrarse con APIs externas (AWS, Azure, GCP)
- Acceder a sistemas de monitoreo (Prometheus, Grafana)

### Instalaci贸n de MCP servers

```bash
# Listar MCP servers disponibles
$ opencode mcp list  # <1>

# Instalar un MCP server (ejemplo: SSH)
$ opencode mcp install mcp-server-ssh  # <2>

# Configurar el MCP server
$ opencode mcp config mcp-server-ssh  # <3>
# <1>
# <2>
# <3>
```

1. **mcp list** muestra los MCP servers disponibles en el registro
2. **mcp install** descarga e instala un MCP server espec铆fico
3. **mcp config** abre el asistente de configuraci贸n del MCP

### MCP Server para Sysadmin: SSH Remote

Configuraci贸n t铆pica para administraci贸n remota:

```json
{
  "mcpServers": {
    "ssh-remote": {
      "command": "npx",
      "args": ["-y", "mcp-server-ssh"],
      "env": {
        "SSH_HOST": "servidor-produccion.ejemplo.com",
        "SSH_USER": "admin",
        "SSH_KEY_PATH": "~/.ssh/id_rsa"
      }
    }
  }
}
```

:::{.callout-warning}
## 锔 ADVERTENCIA CRTICA

**Seguridad con MCP servers**

**Lo que podr铆a salir mal:**
- Exposici贸n de credenciales SSH en configuraci贸n
- Acceso no autorizado a servidores de producci贸n
- Ejecuci贸n accidental de comandos destructivos

**C贸mo prevenirlo:**
1. Usa variables de entorno para credenciales (no hardcodificar)
2. Limita permisos del MCP server (solo lectura si es posible)
3. Testea en staging antes de producci贸n
4. Usa `agent: plan` para revisar comandos antes de ejecutar
:::

### Ejemplo pr谩ctico: Diagn贸stico remoto con MCP

```text
# Conectar a servidor remoto via MCP
/connect mcp:ssh-remote  # <1>

# Ejecutar diagn贸stico de disco
@ssh-remote df -h && du -sh /var/log  # <2>

# Analizar logs de nginx
@ssh-remote tail -n 100 /var/log/nginx/error.log | grep "error"  # <3>
# <1>
# <2>
# <3>
```

1. **/connect mcp:ssh-remote** conecta al servidor configurado via MCP
2. **@ssh-remote** prefijo para ejecutar comandos en el servidor remoto
3. Pipeline de comandos para diagn贸stico de logs

---

## Zen Models (OpenCode Zen)

OpenCode Zen es un servicio de suscripci贸n que proporciona acceso a modelos optimizados para coding agents.

### Caracter铆sticas

- **Modelos validados:** Solo modelos probados y benchmarked por OpenCode
- **Rendimiento consistente:** Sin variaciones de calidad entre proveedores
- **Costo predecible:** Suscripci贸n fija vs API keys variables

### Configuraci贸n

```text
# Conectar a Zen
/connect zen  # <1>

# Listar modelos disponibles
/models  # <2>

# Cambiar modelo activo
/model claude-sonnet-4  # <3>
# <1>
# <2>
# <3>
```

1. **/connect zen** autentica con el servicio Zen
2. **/models** lista modelos disponibles en tu suscripci贸n
3. **/model** cambia el modelo activo para la sesi贸n

### Cu谩ndo usar Zen vs otros proveedores

| Escenario | Recomendaci贸n |
|-----------|---------------|
| Curso/principiantes | Zen (simplicidad) |
| Empresa con compliance | Zen (soporte enterprise) |
| Proyectos personales | API directa (costo variable) |
| Testing m煤ltiples modelos | Zen (cambio f谩cil) |

---

## Laboratorio pr谩ctico (20-30 min)

Objetivo: generar un runbook de "Servidor lento" basado en evidencia.

```bash
$ uptime  # <1>
 11:40:12 up 18 days,  3:12,  2 users,  load average: 2.10, 1.95, 1.20

$ top -b -n 1 | head -n 15  # <2>
top - 11:40:12 up 18 days,  3:12,  2 users,  load average: 2.10, 1.95, 1.20
Tasks: 231 total,   2 running, 229 sleeping,   0 stopped,   0 zombie
%Cpu(s): 12.0 us,  2.5 sy,  0.0 ni, 84.8 id,  0.6 wa,  0.0 hi,  0.1 si,  0.0 st

$ ss -s  # <3>
Total: 842 (kernel 0)
TCP:   125 (estab 48, closed 32, orphaned 0, timewait 32)
UDP:   10
# <1>
# <2>
# <3>
```



1. **uptime** muestra uptime y load average (primer indicador de presion)
2. **top -b -n 1** toma un snapshot no interactivo (pega solo las primeras lineas)
3. **ss -s** resume sockets (util para identificar picos de conexiones)

Entrega:

- Pega en OpenCode: `uptime`, las primeras 15 l铆neas de `top` y `ss -s`.
- Pide: "Dame un plan de diagn贸stico de 10 minutos con comandos read-only, y luego una propuesta de mitigaci贸n con rollback".
- Escribe el runbook usando la plantilla del Ejemplo 3.

---

## Mejores pr谩cticas

:::{.callout-tip}
## RECOMENDACIN

**Usa OpenCode como copiloto, no como piloto autom谩tico.**

Casos de uso:
- Checklists de despliegue y preflight
- Interpretaci贸n de logs y errores
- Generaci贸n de scripts con validaciones y modo seguro

Cuando aplicar:
- Incidentes repetitivos
- Tareas manuales que se hacen m谩s de 2 veces
- Cambios con riesgo (mejorar documentaci贸n y rollback)
:::

---

## Resumen

- Captura evidencia primero (sin cambios)
- Pide a OpenCode hip贸tesis + plan de verificaci贸n
- Ejecuta cambios peque帽os, verificables y reversibles
- Documenta un runbook para el pr贸ximo incidente

## Referencias

### Documentaci贸n Oficial OpenCode
- [OpenCode - Docs](https://opencode.ai/docs)
- [OpenCode - Changelog](https://opencode.ai/changelog)
- [OpenCode - Desktop App](https://opencode.ai/download)
- [OpenCode - Share](https://opencode.ai/docs/share)
- [OpenCode - Commands](https://opencode.ai/docs/commands)
- [OpenCode - MCP Servers](https://opencode.ai/docs/mcp)
- [OpenCode - Zen](https://opencode.ai/zen)

### Linux y Sysadmin
- [systemd - systemctl](https://www.freedesktop.org/software/systemd/man/systemctl.html)
- [journalctl](https://www.freedesktop.org/software/systemd/man/journalctl.html)
- [nginx - Testing Configuration](https://nginx.org/en/docs/beginners_guide.html)

### MCP (Model Context Protocol)
- [MCP Specification](https://modelcontextprotocol.io)
- [MCP Servers Registry](https://github.com/modelcontextprotocol/servers)
- [MCP SSH Server](https://github.com/modelcontextprotocol/servers/tree/main/src/ssh)
