---
title: "Unidad 6.5: RAID y LVM (basico)"
subtitle: "mdadm, volumnes logicos y snapshots"
author: "Diego Saavedra"
date: "2026-02-01"
date-format: medium
---

# Unidad 6.5: RAID y LVM (basico)

## Introduccion

En servidores, el almacenamiento suele requerir:

- **Redundancia** (que un disco se pueda morir sin caida)
- **Flexibilidad** (crecer volumenes sin reinstalar)
- **Snapshots** (backup/logica de punto en el tiempo)

RAID y LVM son dos piezas comunes para lograrlo.

## Objetivos de aprendizaje

Al final, podras:

- Entender RAID 0/1/5/6 a nivel conceptual
- Crear un RAID1 de laboratorio con `mdadm` (con discos loop)
- Crear un volumen LVM basico (PV/VG/LV) y un snapshot

---

## RAID: guia rapida

| Nivel | Objetivo | Pros | Contras |
|-------|----------|------|---------|
| RAID 0 | rendimiento | rapido | sin redundancia |
| RAID 1 | redundancia | simple, tolera 1 disco | capacidad al 50% |
| RAID 5 | balance | tolera 1 disco | rebuild costoso |
| RAID 6 | mas tolerancia | tolera 2 discos | mas overhead |

:::{.callout-warning}
## ⚠️ ADVERTENCIA CRITICA

**RAID NO es backup.**

Lo que podria salir mal:
- Borrado accidental, ransomware o corrupcion se replica.

Como prevenirlo:
1. Mantener backups fuera del arreglo (otra maquina/nube).
2. Probar restauraciones (no solo crear backups).
:::

---

## Laboratorio: RAID1 con mdadm usando discos loop

```bash
$ sudo apt update  # <1>
# <1>

$ sudo apt install -y mdadm  # <2>
# <2>

$ sudo fallocate -l 200M /tmp/u6-raid-a.img  # <3>
# <3>

$ sudo fallocate -l 200M /tmp/u6-raid-b.img  # <4>
# <4>

$ sudo losetup -fP /tmp/u6-raid-a.img  # <5>
# <5>

$ sudo losetup -fP /tmp/u6-raid-b.img  # <6>
# <6>

$ sudo losetup -a | grep u6-raid  # <7>
/dev/loop3: [2065]:22222 (/tmp/u6-raid-a.img)
/dev/loop4: [2065]:33333 (/tmp/u6-raid-b.img)
# <7>

$ sudo mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/loop3 /dev/loop4  # <8>
mdadm: array /dev/md0 started.
# <8>

$ cat /proc/mdstat  # <9>
Personalities : [raid1]
md0 : active raid1 loop4[1] loop3[0]
      204800 blocks super 1.2 [2/2] [UU]
# <9>
```



1. **apt update** actualiza indices (si necesitas instalar herramientas).
2. **mdadm** es la herramienta estandar para RAID por software.
3. **fallocate** crea el primer disco de laboratorio.
4. **fallocate** crea el segundo disco de laboratorio.
5. **losetup** crea `/dev/loop3`.
6. **losetup** crea `/dev/loop4`.
7. **losetup -a** verifica ambos discos loop.
8. **mdadm --create** crea un RAID1 llamado `/dev/md0`.
9. **/proc/mdstat** muestra el estado del arreglo (UU = ambos discos OK).

---

## LVM: PV, VG, LV y snapshot (concepto + demo)

```bash
$ sudo apt install -y lvm2  # <1>
# <1>

$ sudo fallocate -l 300M /tmp/u6-lvm.img  # <2>
# <2>

$ sudo losetup -fP /tmp/u6-lvm.img  # <3>
# <3>

$ sudo losetup -a | grep u6-lvm.img  # <4>
/dev/loop5: [2065]:44444 (/tmp/u6-lvm.img)
# <4>

$ sudo pvcreate /dev/loop5  # <5>
Physical volume "/dev/loop5" successfully created.
# <5>

$ sudo vgcreate vg_data /dev/loop5  # <6>
Volume group "vg_data" successfully created
# <6>

$ sudo lvcreate -n lv_app -L 200M vg_data  # <7>
Logical volume "lv_app" created.
# <7>

$ sudo mkfs.ext4 -F /dev/vg_data/lv_app  # <8>
# <8>

$ sudo mkdir -p /mnt/vg_data  # <9>
# <9>

$ sudo mount /dev/vg_data/lv_app /mnt/vg_data  # <10>
# <10>

$ sudo lvcreate -s -n lv_app_snap -L 50M /dev/vg_data/lv_app  # <11>
Logical volume "lv_app_snap" created.
# <11>
```



1. **lvm2** instala herramientas LVM.
2. **fallocate** crea un disco de laboratorio para LVM.
3. **losetup** crea `/dev/loop5`.
4. **losetup -a** verifica el loop.
5. **pvcreate** inicializa un Physical Volume.
6. **vgcreate** crea el Volume Group.
7. **lvcreate** crea un Logical Volume de 200M.
8. **mkfs.ext4** crea un FS sobre el LV.
9. **mkdir -p** crea el punto de montaje.
10. **mount** monta el LV.
11. **lvcreate -s** crea un snapshot (toma espacio del pool, no es infinito).

---

## Resumen

- RAID mejora disponibilidad/rendimiento segun nivel, pero no reemplaza backups.
- LVM facilita crecer volumenes y crear snapshots.
- Practica con loopback y documenta el procedimiento antes de aplicarlo en produccion.
